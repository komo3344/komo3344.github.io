---
title : Django + Vue Project - (3)
date : 2020-01-02
tags:
    - Vue
    - Nuxt
categories:
    - Django
---

## 3주차
회원가입 로그인 작업, 페이지 권한별 router role설정  
ex) 로그인, 회원가입 페이지는 권한없이 접근 가능하지만 메인페이지는 인증된 클라이언트만 접근 가능


## 프론트와 서버 통신
프론트와 서버가 통신하기 위해서 보안상의 문제로 HTTP 접근 제어 (CORS)설정을 해주어야 한다.  
다른 웹어플리케이션에서 자원을 요청할때 cross-origin HTTP 요청을 실행한다.  
프론트에서 서버에게 회원가입 및 로그인 유저 정보를 가져올때 발생한다.  

## 서버(django) CORS 설정
Django에서 CORS관련 설정을 추가해야한다.  
```shell
$ pip install django-cors-headers
```  

**MSA_Project/settings.py**
```
INSTALLED_APPS = [
    ...
    'corsheaders',

] 
MIDDLEWARE = [
    'corsheaders.middleware.CorsMiddleware',

]

CORS_ORIGIN_ALLOW_ALL = True
CORS_ALLOW_CREDENTIALS = True
CORS_ORIGIN_WHITELIST = (
    'http://127.0.0.1:3000',
)
```  
- CORS_ORIGIN_ALLOW_ALL: 개발단계에서는 True로 한다.  
- CORS_ORIGIN_WHITELIST: 허용할 whitelist 추가(nuxt.js)  


프론트 쪽에서 백엔드와 통신하기 위해 axios라는 패키지를 사용할 것이다.  
```shell
$ npm install --save axios
```  

이제 프론트와 백엔드간의 통신할 준비가 완료되었다.  
axios를 통해 회원가입, 로그인을 하고,  
회원가입 페이지에서 회원가입을 하면 로그인 페이지로 이동  
로그인 페이지에서 로그인을 하면 메인 페이지로 이동하는 것을 구현할 것이다.  
***  

## 회원가입 후 페이지 이동
회원가입 로직은 아래와 같다.  

**pages/signup.vue**  

```html
<template>
<section class="container">
  <div class="signup">
    ...
    <button type="submit" class="btn btn-primary" @click="signup()">회원가입</button>
  </div>
</section>
</template>

<script>
import axios from 'axios'

export default {
  name: 'signup',
  data(){
    return{
      id: '',
      email: '',
      password1: '',
      password2: '',
    }
  },
  methods: {
    signup() {
      axios.post('http://127.0.0.1:8000/rest-auth/registration/', 
      {username: id.value, email: email.value, password1: password1.value, password2:password2.value})
      .then(res => {
        console.log(res)
        alert('회원가입 완료')
        this.$router.push({name: 'login'})
      })
      .catch(e => console.error(e))
    }
  }
}
</script>
```  
사용자가 가입정보를 입력 후 회원가입 버튼을 누르면 **@click="signup()** 함수가 실행된다.  
<script>태크 안에 methods 부분에 signup() 함수가 구현되어 있는데  
axios.post를 통해 입력받은 회원 정보를 장고 서버쪽으로 날려준다.  
장고 서버쪽에서 오는 응답은 console.log(res)로 확인 가능하다.  
회원가입이 되었으면 회원가입이 되었다는 알림을 띄우고 로그인 페이지로 이동시킨다.  
회원가입 실패 시 에러 로그를 띄운다.
***  

## 로그인 후 페이지 이동
```html
<template>
<section class="container">
  <div class="login">
    ...
    <button type="submit" class="btn btn-primary" @click="login()">로그인</button>
    <p>계정이 없으신가요? <nuxt-link to="/signup">회원가입하러 가기</nuxt-link></p>
  </div>
</section>
</template>

<script>
import axios from 'axios'

export default {
  name: 'login',
  data(){
    return{
      token: ''
    }
  },
  methods: {
    login() {
      axios.post('http://127.0.0.1:8000/rest-auth/login/', {username: id.value, password: password.value})
      .then(res=>{
        console.log(res)
        console.log(this.$store.state.is_Login)
        this.$router.push({ name: 'index'})
        })
    .catch(e => {
      console.error(e)
      alert('존재하지 않는 ID이거나 ID, password를 잘못 입력하셨습니다.')
      })
    }
  }
}
</script>
```
